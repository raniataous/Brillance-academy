{"version":3,"file":"./backend/admin-v2.js","mappings":"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","sources":["webpack://learnpress-content-drip/./assets/src/js/backend/admin-v2.js"],"sourcesContent":["/**\n * It updates the drip settings for a course\n * @param childElement - The child element of the table.\n * @param courseID - The ID of the course.\n */\nconst updateSettings = (childElement, courseID) => {\n    const submit = async (dataSettings, btn) => {\n        const ele = document.getElementById('content-drip-settings-message');\n\n        try {\n            const response = await wp.apiFetch({\n                path: 'lp/content-drip/v1/update-settings',\n                method: 'POST',\n                data: {\n                    courseID: courseID,\n                    dataSettings: dataSettings,\n                },\n            });\n\n            btn.classList.remove('loading');\n            const { status, message } = response;\n\n            if (status === 'error') {\n                throw new Error(message || 'Error');\n            }\n\n           // window.location.reload(true);\n        } catch (error) {\n            ele.insertAdjacentHTML(\n                'beforeend',\n                `<div class=\"lp-ajax-message error\" style=\"display:block\">${\n                    error.message || 'Error: Query lp/content-drip/v1/update-settings'\n                }</div>`\n            );\n        }\n    };\n\n    const listButtonUpdate = document.querySelectorAll('.learn-press-update-drip-items');\n\n    if (listButtonUpdate.length === 0) return;\n\n    listButtonUpdate.forEach(function (btn) {\n        btn.addEventListener('click', function (e) {\n            e.preventDefault();\n            btn.classList.add('loading');\n            let dataSettings = [];\n\n            //get settings\n            childElement.forEach(function (ele) {\n                let detailSettings = {};\n\n                //get id\n                const elemTitle = ele.querySelector('td.title-item-content-drip');\n                const id = elemTitle.dataset.id;\n\n                const elePrerequisite = ele.querySelector('select.drip-prerequisite-items');\n                const eleDelayType = ele.querySelector('select.delay-type');\n\n                //get prerequisite\n                if (elePrerequisite !== null) {\n                    const options = elePrerequisite.options;\n                    const valueElePrerequisite = [];\n                    for (var i = 0, iLen = elePrerequisite.options.length; i < iLen; i++) {\n                        opt = options[i];\n                        if (opt.selected) {\n                            valueElePrerequisite.push(opt.value);\n                        }\n                    }\n                    detailSettings.prerequisite = valueElePrerequisite;\n                } else {\n                    detailSettings.prerequisite = [];\n                }\n\n                //get type\n                if (eleDelayType !== null) {\n                    detailSettings.type = eleDelayType.value;\n                }\n\n                //type == specific\n                const eleDelayDatePicker = ele.querySelector('input.delay-specific-datetimepicker');\n                if (eleDelayDatePicker !== null) {\n                    detailSettings.date = eleDelayDatePicker.value;\n                }\n                //end specific\n\n                //type = interval\n                const eleDelayTime = ele.querySelector('input.delay-interval-0');\n                if (eleDelayTime !== null) {\n                    detailSettings.interval = eleDelayTime.value;\n                }\n\n                const eleDelayTimeType = ele.querySelector('select.delay-interval-1');\n                if (eleDelayTimeType !== null) {\n                    detailSettings.interval_type = eleDelayTimeType.value;\n                }\n\n                //end interval\n                dataSettings.push({\n                    id: id,\n                    settings: detailSettings,\n                });\n            });\n\n            submit(dataSettings, btn);\n        });\n    });\n};\n\n/**\n * It adds an event listener to a button that, when clicked, sends an AJAX request to the server to\n * reset the drip settings for a course\n * @param childElement - The child element of the parent element.\n * @param courseID - The ID of the course.\n */\nconst resetSetings = (childElement, courseID) => {\n    const submit = async (dataReset, btn) => {\n        const ele = document.getElementById('content-drip-settings-message');\n\n        try {\n            const response = await wp.apiFetch({\n                path: 'lp/content-drip/v1/reset-settings',\n                method: 'POST',\n                data: {\n                    courseID: courseID,\n                    dataReset: dataReset,\n                },\n            });\n\n            btn.classList.remove('loading');\n            const { status, message } = response;\n\n            if (status === 'error') {\n                throw new Error(message || 'Error');\n            }\n\n            window.location.reload(true);\n        } catch (error) {\n            ele.insertAdjacentHTML(\n                'beforeend',\n                `<div class=\"lp-ajax-message error\" style=\"display:block\">${\n                    error.message || 'Error: Query lp/content-drip/v1/reset-settings'\n                }</div>`\n            );\n        }\n    };\n\n    const listButtonReset = document.querySelectorAll('.learn-press-reset-drip-items');\n\n    if (listButtonReset.length === 0) return;\n\n    listButtonReset.forEach(function (btn) {\n        btn.addEventListener('click', function (e) {\n            e.preventDefault();\n            btn.classList.add('loading');\n            const dataReset = [];\n\n            childElement.forEach(function (ele) {\n                //get id\n                const elemTitle = ele.querySelector('td.title-item-content-drip');\n                const id = elemTitle.dataset.id;\n\n                dataReset.push(id);\n            });\n\n            submit(dataReset, btn);\n        });``\n    });\n};\n\nconst saveCourse = () => {\n    \n    //gutenberg publish course\n    const inputEnable = document.querySelector('#lp_contentdrip_course_data input#_lp_content_drip_enable');\n    if( inputEnable !== null ) {\n        let timeOut;\n        inputEnable.addEventListener('change', function (e) {\n            if( e.target.checked ) {\n                document.addEventListener('click', function (btn) {\n                    if(btn.target.classList.contains('editor-post-publish-button')){\n                        timeOut = setInterval(function(){\n                            if(document.querySelector('div.edit-post-meta-boxes-area.is-normal.is-loading') !== null) {\n                                let timoutMetabox = setInterval(function(){\n                                    if( ! document.querySelector('div.edit-post-meta-boxes-area').classList.contains('is-loading')) {\n                                        clearInterval(timoutMetabox);\n                                        clearInterval(timeOut);\n                                        window.location.reload(true);\n                                    }\n                                },1000);\n                            }\n                        },1000);\n                    }\n                });\n            }\n        });\n    }\n        \n    const btn = document.querySelector('#lp_contentdrip_course_data a.save-post-ctd');\n\n    if (btn === null) return;\n\n    btn.addEventListener('click', function (e) {\n        e.preventDefault();\n        let btnSubmit;\n        if (document.querySelector('#publishing-action input#publish') !== null) {\n            btnSubmit = document.querySelector('#publishing-action input#publish');\n        } else {\n            btnSubmit = document.querySelector('button.editor-post-publish-button__button');\n        }\n        if (btnSubmit !== null) {\n            btnSubmit.click();\n        }\n    });\n};\n\ndocument.addEventListener('DOMContentLoaded', function () {\n    saveCourse();\n    const tableElem = document.querySelector('table.learnpress_page_content-drip-items');\n    if (tableElem === null) return;\n\n    const childElement = tableElem.querySelectorAll('tbody#the-list tr');\n    if (childElement.length === 0) return;\n\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const courseID = urlParams.get('course-id');\n\n    updateSettings(childElement, courseID);\n    resetSetings(childElement, courseID);\n});\n"],"names":["updateSettings","childElement","courseID","submit","dataSettings","btn","ele","document","getElementById","response","wp","apiFetch","path","method","data","classList","remove","status","message","Error","error","insertAdjacentHTML","listButtonUpdate","querySelectorAll","length","forEach","addEventListener","e","preventDefault","add","detailSettings","elemTitle","querySelector","id","dataset","elePrerequisite","eleDelayType","options","valueElePrerequisite","i","iLen","opt","selected","push","value","prerequisite","type","eleDelayDatePicker","date","eleDelayTime","interval","eleDelayTimeType","interval_type","settings","resetSetings","dataReset","window","location","reload","listButtonReset","saveCourse","inputEnable","timeOut","target","checked","contains","setInterval","timoutMetabox","clearInterval","btnSubmit","click","tableElem","queryString","search","urlParams","URLSearchParams","get"],"sourceRoot":""}